
OpenOnload 201210 Release Notes
===============================

 This is a beta release that adds new features to OpenOnload.  We would be
 very grateful if you could test this release and report any issues you
 find to support@solarflare.com.

 Below is a brief summary of the major new features and limitations that we
 are aware of.  See the ChangeLog for further details and bugs fixed.


----------------------------------------
New features
------------

- Use huge pages for Onload packet buffers (EF_USE_HUGE_PAGES).

- Improvements to onload_stackdump default output and new commands.

- Performance improvements in epoll_wait() and poll().

- Physical addressing mode (EF_PACKET_BUFFER_MODE=2 or 3).

- Option to put TCP loopback connections in a separate stack.

- sendmmsg() support for accelerated UDP sockets, whether or not GLIBC
  and/or the kernel support this call.

- Net driver: VLAN insertion and stripping support.

- Firewalling including Iptables integration (BETA).


----------------------------------------
Configuration options
---------------------

 The following new configuration options have been added:

 EF_PACKET_BUFFER_MODE
 - New options 2 and 3 enable physical addressing mode.  Physical
   addressing mode is insecure in that the user-level application can
   provoke the network adapter to read and write arbitrary addresses in
   memory.  See also phys_mode_gid below.

  EF_TCP_CLIENT_LOOPBACK=4
  - New option 4 causes TCP loopback connections to be placed in a separate
    Onload stack.  This can improve performance by reducing contention
    between resources.

  EF_USE_HUGE_PAGES
  - Enable use of huge pages for packet buffers.

  EF_VALIDATE_ENV
  - Warn about any obsolete or misspelled options in the environment.


----------------------------------------
Module options
--------------

 The following module options have been added:

 epoll2_max_stacks (onload module)
 - Controls the maximum number of stacks that an epoll fd can handle when
   EF_UL_EPOLL=2.

 phys_mode_gid (onload module)
 - Set this option to enable physical addressing mode and restrict which
   users can use it.

 shared_buffer_table (sfc_resource module)
 - This module option needs to be set to enable legacy ef_vi applications
   that use the ef_iobufset API.  For example, setting
   shared_buffer_table=10000 makes 10000 buffer table entries available for
   use with ef_iobufset.


 The following module options have been removed:

 unsafe_sriov_without_iommu (sfc_resource module)
 - Obsoleted by the new physical addressing modes and phys_mode_gid.

 buffer_table_min (sfc_resource module)
 buffer_table_max
 - These options existed because previous versions of the sfc_resource
   driver required uniform resources across all network adapters.  That
   caused problems when different types of adapter were placed together in
   one host.  That limitation is no longer present, so these module options
   are not needed.


----------------------------------------
Iptables and firewalling
------------------------

 This release adds a BETA of support for iptables integration.  This
 feature allows the administrator to place limits on which flows are
 permitted to bypass the kernel stack.  Flows that are not permitted to
 bypass the kernel stack are therefore subject to iptables rules (if
 enabled) in the normal way.

 This feature does not perform iptables rules checking on the adapter
 itself.

 The onload_iptables script provides a way to configure the Onload firewall
 automatically so that a subset of iptables rules will be respected when
 using Onload.  The script should tell you about any iptables rules that
 are incompatible with Onload acceleration.


----------------------------------------
ef_iobufset is deprecated
-------------------------

 The ef_iobufset interface in ef_vi is deprecated and will be removed in a
 future release.  We recommend you migrate ef_vi applications to the
 ef_memreg interface instead.


----------------------------------------
Known bugs
----------

 - bug31498: sendmmsg() returns error code incorrectly.

 - bug31280: Build failure with gcc 4.7.1 due to string concatenation.


David Riddoch
2012/10/09
