OpenOnload-201310-u2 Release Notes
==================================

This is an update release that fixes bugs in openonload-201310 and
adds a few enhancements.

The accompanying ChangeLog file contains details of the changes made
in this release.

Please see ReleaseNotes-sfc for details of changes to the sfc net driver

The Release Notes for the openonload-201310 and openonload-201310-u1
releases are included at the end of this file.

----------------------------------------
New Configuration Options
-------------------------

EF_LOG

This option is designed to control how "chatty" Onload's informative
and warning messages are.  It takes a comma-separated list of message
groups to enable and disable (if prefixed with a minus sign).

Current valid message groups are:
 banner (on by default) for the Onload copyright banner;
 resource_warnings (on by default) for (e.g.) huge page allocation messages;
 conn_drop (off by default) for (e.g.) connections dropped from listen queue;
E.g. to enable conn_drop and disable resource_warnings set:
EF_LOG=conn_drop,-resource_warnings

Future releases will likely extend the set of messages controlled by
each group and add more groups of log messages that can be controlled
in this way.

----------------------------------------
New features
------------

 - solar_clusterd: this uses support for ef_vi application clustering
 to allow SolarCapturePro to scale across many CPUs.  Application
 clustering allows a stream of traffic to be split across many VIs so
 that a cluster of applications can process it in parallel to increase
 scalability.

 - unicast-all and multicast-all ef_vi filters: the change in
 semantics outlined below for openonload-201310-u1 has now been
 resolved, such that unicast-all only blocks unicast traffic, and
 multicast-all only blocks multicast traffic.

 - phys_mod_gid module option to sfc_char: this controls the group ID
 of ef_vi applications which are allowed to use physical buffer mode.


OpenOnload-201310-u1 Release Notes
==================================

This is an update release that fixes bugs in openonload-201310 and
adds a few enhancements.

The accompanying ChangeLog file contains details of the changes made
in this release.

Please see ReleaseNotes-sfc for details of changes to the sfc net driver

The Release Notes for the openonload-201310 release are included at
the end of this file.

----------------------------------------
New Configuration Options 
-------------------------

EF_TX_PUSH_THRESHOLD
 - Sets a threshold for the number of outstanding sends before we stop
   using TX descriptor push.

----------------------------------------
New features 
------------

- Support for hardware timestamping of packets using the
SO_TIMESTAMPING API on hardware that is capable of this (7000-series
adapters).  It is recommended to update to latest GA firmware to use
this feature.

- The PIO feature that reduces latency can now be used on multiple
sends in parallel.  Likewise multiple templated sends in parallel are
now also possible.

- On 7000-series NICs, the ef_vi support for multicast-all and
unicast-all filters has been restored.  See Known Issues below for one
important caveat.

- Added ef_filter_spec_set_{unicast,multicast}_mismatch() to ef_vi API
to allow reception of packets that do not match other filters.

- Added onload_fd_check_feature() extension API to allow caller to check
if ONLOAD_MSG_WARM is supported/safe on a given file descriptor.

----------------------------------------
New Known Issues
----------------

- Due to the AMD IOMMU driver not returning aligned PCI addresses the use
of huge pages on systems with AMD IOMMUs is not supported.

- Due to changes in the features requested by Onload when running on
7000-series adapters which are not supported by earlier firmware
versions, it is necessary to update to firmware version v4.0.0.6602 or
later to use this version of Onload on those adapters. (Issue39531)

- There is a change in semantics of multicast-all and unicast-all
ef_vi filters in this release: a multicast-all filter normally blocks
other multicast receivers from receiving traffic, but it will also now
block an unaccelerated unicast receiver.  Similarly a unicast-all
filter will also block an unaccelerated multicast receiver.  We hope
to correct this in a future update release.


OpenOnload-201310 Release Notes
===============================

This is a major update release that adds new features to OpenOnload.

Below is a brief summary of the new features and limitations that we
are aware of.  See the ChangeLog for further details and bugs fixed.


----------------------------------------
New features 
------------

This release adds the following new features.  Please see the user
guide for full details.

- Support for the Solarflare 7000-series adapters including the SFN7122F.
New features of 7000-series adapters include hardware multicast
replication, large buffer table support, reduced latency and the templated
sends API (see below).

- MSG_WARM, a new flag which when used on TCP send calls will exercise
the send path to keep it warm and improve the latency of subsequent
sends.

- Support for the PowerPC architecture.

- A JNI wrapper for the onload extensions API is now included.

- SO_TIMESTAMP[NS] is now supported for accelerated TCP sockets

- Added extension API (onload_stack_opt_set_int()) to set onload stack
options at runtime.

- Added extension API (onload_stackname_save(),
onload_stackname_restore()) to save and restore current stack name.


----------------------------------------
Configuration Options 
---------------------

The following new configuration options have been added:

EF_PIO
 - Control of whether the Programmed I/O (PIO) latency optimisation is used
 on SFN7122F adapters.

EF_PIO_THRESHOLD
 - Set the maximum packet size that will use PIO.

EF_VFORK_MODE
 - Control how vfork() interception works.

EF_TCP_SNDBUF_MODE
 - Control whether send buffer limit applies to just the TCP send queue, or
 to the sum of the TCP send and retransmit queues.

The sfc_resource module option "shared_buffer_table" has been removed
(see discussion of ef_iobufset below).


----------------------------------------
Known Issues
------------

- The PIO feature that reduces latency can only be used for a single
outstanding send at a time, so applications doing a number of sends in
quick succession are likely to get the performance advantage only for the
first send.  This limitation will addressed in an update in the near
future.

- 32 bit application binaries are known not to work correctly with
OpenOnload on PowerPC architectures.  This issue only affects PowerPC.

- SRIOV is not supported in this release on PowerPC architectures.  We
recommend using EF_PACKET_BUFFER_MODE=0 or 2, but not 1 or 3.

- PowerPC architectures do not currently support the new PIO method
for reducing transmit latency (EF_PIO).  We recommend setting EF_PIO=0.

- EEH error injection tests on PowerPC systems have been seen to cause
the NIC to be disabled by the hypervisor.  This can be recovered by
resetting the system.

- Some SLES11 kernels exhibit a bug when running OpenOnload with SRIOV
and Intel IOMMUs.  This is typically seen when loading drivers.  This
bug has been fixed in more recent kernels (introduced in 3.1, fixed in
3.6 and 3.2.stable).

- When switching between "low-latency" and "full-featured" firmware
variants it is necessary to reload drivers afterwards for the change
to fully take effect.

- On 7122f NICs, the ef_vi support for multicast-all and unicast-all
filters does not work.  Attempts to install such filters will return
an error.  (Support will be added at a later date).

- On 7122f NICs, we currently only support 1 physical function per NIC
port.

- Reloading drivers on 7122f NICs on SLES10 OS using MSI-X has been
seen to result in the driver failing to obtain an interrupt and
reporting MCDI request timeouts.  This can be worked around by setting
interrupt_mode=0 module option for the sfc driver to force MSI
interrupts.

- In rare circumstances the combination of a zero-copy send and the
accelerated TCP loopback feature causes a connection to get
stuck/corrupted.  (In DEBUG builds an assertion is triggered).  This is not
a regression, and affects earlier releases in the same way.

- There is a small difference in semantics of ef_vi_filter_add() on
7122f and Siena NICs.  On Siena, if you try to insert a MAC filter,
and there is already an existing matching MAC filter, it will fail.
On 7122f this is also the case for explicit MAC filters, but an
existing implicit MAC filter will get replaced and the new filter will
succeed.

- This release removes support for the ef_iobufset API.  ef_vi
applications that use this will not work with this release, and ef_vi
binaries compiled against EnterpriseOnload 2.0 and OpenOnload 201109
and earlier will not work with this release.  ef_vi applications
should be updated to use the ef_memreg API instead.


----------------------------------------
Templated send API
------------------

This release includes a preview of the "Templated Send API" for 7000-series
adapters.  See /usr/include/onload/extensions_zc.h for details.

WARNING: The implementation in this release has a number of known bugs, and
has not yet been fully performance optimised.

This API provides a way to reduce the latency of TCP sends by providing a
template for a message in advance of the critical path.  This allows Onload
to perform a number of steps ahead of the critical path, including copying
the message payload to the adapter.  On the critical path the application
can optionally update the message, and then send it.

This implementation has a number of bugs in the handling of changes to the
control plane.  In particular, if the route to the socket's peer changes so
that packets are routed to a different layer-2 interface then the packet
may be routed via the wrong interface.

This implementation only allows a single message template to be outstanding
at a time.

The above mentioned limitation and bugs will be addressed in an update in
the near future.
